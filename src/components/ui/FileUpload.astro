---
interface Props {
  name: string;
  id?: string;
  label?: string;
  accept?: string;
  multiple?: boolean;
  required?: boolean;
  class?: string;
}

const {
  name,
  id = name,
  label,
  accept = 'image/*',
  multiple = false,
  required = false,
  class: className = '',
} = Astro.props;
---

<div class={`space-y-1.5 ${className}`}>
  {label && (
    <label for={id} class="block text-sm font-medium text-surface-700">
      {label}
      {required && <span class="text-red-500 ml-0.5">*</span>}
    </label>
  )}
  <div class="relative">
    <input
      type="file"
      name={name}
      id={id}
      accept={accept}
      multiple={multiple}
      required={required}
      class="hidden"
    />
    <label
      for={id}
      class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-surface-300 rounded-lg cursor-pointer hover:border-primary-400 hover:bg-primary-50/50 transition-colors duration-200"
    >
      <div class="flex flex-col items-center justify-center pt-5 pb-6">
        <svg class="w-8 h-8 text-surface-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
        </svg>
        <p class="text-sm text-surface-600">
          <span class="font-medium text-primary-600">Click to upload</span> or drag and drop
        </p>
        <p class="text-xs text-surface-400 mt-1">PNG, JPG, GIF up to 5MB</p>
      </div>
    </label>
    <div id={`${id}-preview`} class="mt-3 grid grid-cols-3 gap-2 hidden"></div>
  </div>
</div>

<script define:vars={{ id }}>
  const input = document.getElementById(id);
  const preview = document.getElementById(`${id}-preview`);
  
  input?.addEventListener('change', (e) => {
    const files = e.target.files;
    if (!files || !preview) return;
    
    preview.innerHTML = '';
    preview.classList.remove('hidden');
    
    Array.from(files).forEach((file) => {
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target?.result;
          img.className = 'w-full h-20 object-cover rounded-lg border border-surface-200';
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    });
  });
</script>

